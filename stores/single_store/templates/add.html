{% extends "layout.html" %}
{% block content %}
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
  integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.tiny.cloud/1/tgrybbrczjfzbzqdyj2scw84czfmx90a6urirqulti3vk84b/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>

<div class="content-section">
  <form method="POST" action="" enctype="multipart/form-data">
    {{ form.csrf_token }}
    {{ form.form_type }}
    <fieldset class="form-group">
      <legend class="border-bottom mb-4">New {{title}}</legend>
      <script>let slug</script>
      {% for field in form if field.name != 'csrf_token' %}
        {% if field.name != 'form_type' and field.name != 'submit'  %}
          {% if loop.index ==1 %}
            {% set id = field.name %}
            <script>
              var id = '{{id}}';
              var values = '';
              $(document).on('input', '#{{id}}', function(){
                var values = $(this).val();
                values = values.toLowerCase();
                values = values.replace(/&/g, "");
                values = values.replace(/"/g, "");
                values = values.replace(/'/g, "");
                values = values.replace(/ /g, "-");
                $("#slug").val(values);
              });
              
              $(document).on('focusout', '#{{id}}', function(){
                var slugs = JSON.parse('{{slug|safe|tojson}}');
                slugs = slugs.replace(/'/g, "");
                slugs = slugs.replace(/[\[\]']+/g, "");
                slugs = slugs.replace(/ /g, "");
                var slug_list = slugs.split(",");
                for (i=0; i<slug_list.length; i++){
                  if(slug_list[i] == $("#slug").val()){
                    var random_number = Math.floor(Math.random() * 100);
                    final_slug = slug_list[i] + '-' + random_number
                    $("#slug").val(final_slug);
                  }
                }

              });
            </script>
          {% endif %}
          <div class="form-group">
            {{ field.label(class="form-control-label") }}
            {{ field(class="form-control") }}

            {% for error in field.errors %}
            <div class="error">{{ error }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
      <input type="submit" name="submit">
    </fieldset>

  </form>
</div>


<script>

  tinymce.init({
    selector: '#shortDescription',
    branding: false,
    plugins: [
            'advlist autolink link image imagetools lists charmap print preview hr anchor pagebreak spellchecker',
            'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
            'save table contextmenu directionality template paste textcolor codesample'
        ],
        imagetools_toolbar: "rotateleft rotateright | flipv fliph | editimage imageoptions",
        toolbar: 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons | codesample',
        codesample_languages: [
            { text: 'HTML/XML', value: 'markup' },
            { text: 'JavaScript', value: 'javascript' },
            { text: 'CSS', value: 'css' },
            { text: 'Processing', value: 'processing' },
            { text: 'Python', value: 'python' }
        ],
        width: "100%",

 });


    tinymce.init({
      selector: '#longDescription',
      branding: false,
      plugins: [
            'advlist autolink link image imagetools lists charmap print preview hr anchor pagebreak spellchecker',
            'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
            'save table contextmenu directionality template paste textcolor codesample'
        ],
        imagetools_toolbar: "rotateleft rotateright | flipv fliph | editimage imageoptions",
        toolbar: 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons | codesample',
        codesample_languages: [
            { text: 'HTML/XML', value: 'markup' },
            { text: 'JavaScript', value: 'javascript' },
            { text: 'CSS', value: 'css' },
            { text: 'Processing', value: 'processing' },
            { text: 'Python', value: 'python' }
        ],
        width: "100%",

   });

  </script>

{% endblock content %}